---
title: "rabies.qmd"
format: html
editor: visual
---

## Rabies project - Key

Please note that there are as many ways to do something in R as there are users of R. **Your solutions should be focused on using the methods we are learning in Chapter 3 of GSWR.**

## Rabies project

You are receiving a dataset from the New York State Department of Health that shows test results for specimens submitted to be tested for rabies.

## Set things up and read in the data

Add the code to set up the workspace

```{r}
rm(list = ls())
library(tidyverse)
library(here)
```

Now read in the data and name it as an object called `rabies`.

```{r}
rabies <-read.csv(here("Data", "Rabies_Laboratory_Submissions.csv"))
```

## Get started

Use a combination of filter, select, slice, arrange, group_by, summarize, mutate or any other functions covered in Chapter 3 of GSWR to answer the following questions about this data set.

Your goals are twofold:

-   To practice using the material from Chapter 3 of GSWR and
-   To learn something about rabies in New York.

1.  After you read in all of the data, create a new data frame called rabies that includes just the first 7 columns (omit latitude, longitude and geocode information) from the original dataset.

```{r}
rabies <- rabies %>% select(1:7)
```

2.  Create a new column in your dataset called "Percent_pos" and set it equal to the (number of positive samples / number of samples)\*100.

```{r}
rabies <- rabies %>% mutate(
  Percent_pos = (Positive.Samples/Number.of.Samples)*100
)
```

*After you have taken care of tasks 1 and 2, you may wish to divide up the work among your group members by assigning different questions to different team members.*

3.  In what year was the highest total number of sample submissions received? (Hint: you might want the `sum()` function)

```{r}
rabies %>% 
  group_by(Received.Year) %>% 
  summarize(
    num_submissions = sum(Number.of.Samples)) %>% 
  arrange(desc(num_submissions))
```

4.  In what year and in what county was the highest positive number of samples received?

```{r}
rabies %>% 
  group_by(Received.Year, County.Name) %>% 
  summarise(
    num_pos_submissions = sum(Positive.Samples)) %>% 
  arrange(desc(num_pos_submissions)) %>% View()
```

5.  How many rows of data are there that include submissions from bats for which the samples were positive for rabies? For which the samples were not positive for rabies?

```{r}
rabies %>% 
  filter(Animal.Classification == "Bat" & Positive.Samples > 0)

rabies %>% 
  filter(Animal.Classification == "Bat" & Positive.Samples == 0)
```

6.  How many animal types were there for which, in instances in which there were more than 4 samples submitted at a time, the percent of positive samples was greater than 50%?

```{r}
rabies_sum<-rabies %>% 
  select(Animal.Classification, Number.of.Samples, Percent_pos) %>%
  group_by(Animal.Classification) %>%  
  filter(Number.of.Samples > 4 & Percent_pos > 50) %>% 
  arrange(Animal.Classification)

```

7.  Create a new dataset that includes only data from St. Lawrence County and name it SLC. Next, calculate, by Animal.Classification, the total number of submissions per year, the total number of positive submissions per year, and then the percent positive per year based on those two totals. Save your results in a new data frame called SLC_animals.

```{r}
SLC <- rabies %>% filter(County.Name == "St. Lawrence")

SLC_animals <- SLC %>% 
  group_by(Received.Year, Animal.Classification) %>% 
  summarise(
    total_submissions = sum(Number.of.Samples),
    total_positive = sum(Positive.Samples),
    total_percent_pos = (total_positive/total_submissions)*100
  ) %>% 
  View()
```

8.  Create a new dataset that includes only data from St. Lawrence County from 2020 to present. Name the dataset `SLC_recent`.

```{r}
SLC_recent <- rabies %>% filter(County.Name == "St. Lawrence" & Received.Year > 2019)
```

9.  What was the animal type for which the highest percent of submitted samples tested positive by year in your St. Lawrence County dataset? What is the average percent positive by year?

```{r}
slc_mean <-SLC %>% 
  group_by(Received.Year, Animal.Classification) %>% 
  summarise(
    highest_percent = max(Percent_pos),
    mean_percent = mean(Percent_pos)) %>% 
  arrange(desc(highest_percent))
```

When you have finished working on your questions, save your changes and commit them. Working from your branch (and not *main*), push your changes to your repository and then open a Pull Request to have the changes incorporated into your group repository.
